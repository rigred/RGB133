<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Vision Utils: include/Capture.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>include/Capture.h File Reference</h1><code>#include &lt;linux/videodev2.h&gt;</code><br>
<code>#include &lt;pthread.h&gt;</code><br>
<code>#include &quot;<a class="el" href="CaptureTypes_8h-source.html">CaptureTypes.h</a>&quot;</code><br>

<p>
<a href="Capture_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__sBuffer.html">_sBuffer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__sCapture.html">_sCapture</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#fab7e80b660d9cc4150a9992888bd56d">NUM_STREAMING_BUFFERS</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#3eeb09936e8b8b09aaad26ff2c859eb7">BOOL</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct__sBuffer.html">_sBuffer</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#904661bbc130a58408c0d18d5e5d4a55">sBuffer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct__sBuffer.html">_sBuffer</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#d956802a92fe6f5a0dbfa443b13e25d3">psBuffer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct__sCapture.html">_sCapture</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#1d8341d4e67c3218a3ecaded2492287d">sCapture</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct__sCapture.html">_sCapture</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#1a2dd8fb6ba70b55df40ffe1dc5d0592">psCapture</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#e187b90c9ab74448d17af5cbbd5afff3">OpenCaptureDevice</a> (char *device, <a class="el" href="struct__sCapture.html">psCapture</a> pCapture, <a class="el" href="Capture_8h.html#3eeb09936e8b8b09aaad26ff2c859eb7">BOOL</a> bBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#269745cd0d528279e695e6245675679e">OpenCaptureDeviceControl</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture, const char *ctrlDevice)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#70999d21cf9cba87e7513ad225e92f41">CloseCaptureDevice</a> (int fd, <a class="el" href="struct__sCapture.html">psCapture</a> pCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#a5c348b8bd6cbff79961aab6d3e9525e">CloseCaptureDeviceControl</a> (int fd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#95ccbfb78416121353034ce553f3941f">InitialiseReadCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture, unsigned int buffer_size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#874c690a8b26f9133303818f37009920">UninitialiseReadCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#d9c81ca1c4c7610a71773a7db7aff659">InitialiseMmapCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture, unsigned int buffer_size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#6f89dd6def14eee7d40c0824b094f0a7">InitialiseUserPtrCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture, unsigned int buffer_size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#60475b15bcc2b6246d7b46d18dcddff0">UninitialiseMmapCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#8f2b074dc39118a4a32364182d590290">UninitialiseUserptrCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#2646d186dcb3c2ad0565196bc571f57a">InitialiseCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#cae4622ab88f429fbaf6fb4810ff2dd1">StartCapture</a> (<a class="el" href="struct__sCapture.html">psCapture</a> pCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="Capture_8h.html#5fb866fca5bb4eddd5a740b491e0bca1">IsSupportedPixelFormat</a> (char *pixfmt)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="fab7e80b660d9cc4150a9992888bd56d"></a><!-- doxytag: member="Capture.h::NUM_STREAMING_BUFFERS" ref="fab7e80b660d9cc4150a9992888bd56d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_STREAMING_BUFFERS&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="3eeb09936e8b8b09aaad26ff2c859eb7"></a><!-- doxytag: member="Capture.h::BOOL" ref="3eeb09936e8b8b09aaad26ff2c859eb7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int <a class="el" href="Capture_8h.html#3eeb09936e8b8b09aaad26ff2c859eb7">BOOL</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d956802a92fe6f5a0dbfa443b13e25d3"></a><!-- doxytag: member="Capture.h::psBuffer" ref="d956802a92fe6f5a0dbfa443b13e25d3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__sBuffer.html">_sBuffer</a> * <a class="el" href="struct__sBuffer.html">psBuffer</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="1a2dd8fb6ba70b55df40ffe1dc5d0592"></a><!-- doxytag: member="Capture.h::psCapture" ref="1a2dd8fb6ba70b55df40ffe1dc5d0592" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__sCapture.html">_sCapture</a> * <a class="el" href="struct__sCapture.html">psCapture</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parent capture structure.<ul>
<li>Contains all video4linux data as well as output buffer pointer and information. </li></ul>

</div>
</div><p>
<a class="anchor" name="904661bbc130a58408c0d18d5e5d4a55"></a><!-- doxytag: member="Capture.h::sBuffer" ref="904661bbc130a58408c0d18d5e5d4a55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__sBuffer.html">_sBuffer</a>  <a class="el" href="struct__sBuffer.html">sBuffer</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="1d8341d4e67c3218a3ecaded2492287d"></a><!-- doxytag: member="Capture.h::sCapture" ref="1d8341d4e67c3218a3ecaded2492287d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__sCapture.html">_sCapture</a>  <a class="el" href="struct__sCapture.html">sCapture</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parent capture structure.<ul>
<li>Contains all video4linux data as well as output buffer pointer and information. </li></ul>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="70999d21cf9cba87e7513ad225e92f41"></a><!-- doxytag: member="Capture.h::CloseCaptureDevice" ref="70999d21cf9cba87e7513ad225e92f41" args="(int fd, psCapture pCapture)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CloseCaptureDevice           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of CloseCaptureDevice. <div class="fragment"><pre class="fragment"><a name="l00864"></a>00864 {
<a name="l00865"></a>00865    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Closing capture device fd: %d\n"</span>, fd);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867    <span class="comment">/* Check for allocated memory */</span>
<a name="l00868"></a>00868    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#ca5d5288dbafbccedce2b101cc353cd1">pInputs</a>)
<a name="l00869"></a>00869    {
<a name="l00870"></a>00870       free(pCapture-&gt;<a class="code" href="struct__sCapture.html#ca5d5288dbafbccedce2b101cc353cd1">pInputs</a>);
<a name="l00871"></a>00871       pCapture-&gt;<a class="code" href="struct__sCapture.html#ca5d5288dbafbccedce2b101cc353cd1">pInputs</a> = 0;
<a name="l00872"></a>00872    }
<a name="l00873"></a>00873    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#26bead8bc59b9f86af66e677f1e69130">pStandards</a>)
<a name="l00874"></a>00874    {
<a name="l00875"></a>00875       free(pCapture-&gt;<a class="code" href="struct__sCapture.html#26bead8bc59b9f86af66e677f1e69130">pStandards</a>);
<a name="l00876"></a>00876       pCapture-&gt;<a class="code" href="struct__sCapture.html#26bead8bc59b9f86af66e677f1e69130">pStandards</a> = 0;
<a name="l00877"></a>00877    }
<a name="l00878"></a>00878    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#2f99b5f4e58a5e92daef4d7f5ac37a19">pFormats</a>)
<a name="l00879"></a>00879    {
<a name="l00880"></a>00880       free(pCapture-&gt;<a class="code" href="struct__sCapture.html#2f99b5f4e58a5e92daef4d7f5ac37a19">pFormats</a>);
<a name="l00881"></a>00881       pCapture-&gt;<a class="code" href="struct__sCapture.html#2f99b5f4e58a5e92daef4d7f5ac37a19">pFormats</a> = 0;
<a name="l00882"></a>00882    }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884    <span class="comment">/* close the handle */</span>
<a name="l00885"></a>00885    close(fd);
<a name="l00886"></a>00886 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a5c348b8bd6cbff79961aab6d3e9525e"></a><!-- doxytag: member="Capture.h::CloseCaptureDeviceControl" ref="a5c348b8bd6cbff79961aab6d3e9525e" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CloseCaptureDeviceControl           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of CloseCaptureDeviceControl. <div class="fragment"><pre class="fragment"><a name="l00892"></a>00892 {
<a name="l00893"></a>00893    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Closing capture device control fd: %d\n"</span>, fd);
<a name="l00894"></a>00894 
<a name="l00895"></a>00895    <span class="comment">/* close the handle */</span>
<a name="l00896"></a>00896    close(fd);
<a name="l00897"></a>00897 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2646d186dcb3c2ad0565196bc571f57a"></a><!-- doxytag: member="Capture.h::InitialiseCapture" ref="2646d186dcb3c2ad0565196bc571f57a" args="(psCapture pCapture)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitialiseCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of InitialiseCapture. <div class="fragment"><pre class="fragment"><a name="l00656"></a>00656 {
<a name="l00657"></a>00657    <span class="keyword">struct </span>v4l2_selection crop, compose;
<a name="l00658"></a>00658    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d1 = 0;
<a name="l00659"></a>00659    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d2 = 0;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661    <span class="keywordtype">int</span> rc = 0;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663    <span class="comment">/* Initialise internals */</span>
<a name="l00664"></a>00664    pCapture-&gt;<a class="code" href="struct__sCapture.html#f41c0a3893467798a400eed15bcbe6d9">inputs</a> = 0;
<a name="l00665"></a>00665    pCapture-&gt;<a class="code" href="struct__sCapture.html#6c4955c3143ec8a52272b694a5772e6c">standards</a> = 0;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667    <span class="comment">/* Setup the capture rate, if rate is 0.0</span>
<a name="l00668"></a>00668 <span class="comment">    * don't set, just use the default which is the input rate</span>
<a name="l00669"></a>00669 <span class="comment">    */</span>
<a name="l00670"></a>00670    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#e401f9095d991b5518f74d204fee15a8">fFrameRate</a> &gt; 0.0)
<a name="l00671"></a>00671    {
<a name="l00672"></a>00672       <span class="comment">/* Convert the fp frame rate into a numerator and denominator for</span>
<a name="l00673"></a>00673 <span class="comment">       * use in the v4l struct</span>
<a name="l00674"></a>00674 <span class="comment">       *  - Assume numerator is 1001 (??)</span>
<a name="l00675"></a>00675 <span class="comment">       *</span>
<a name="l00676"></a>00676 <span class="comment">       *  - Calculate denominator</span>
<a name="l00677"></a>00677 <span class="comment">       *</span>
<a name="l00678"></a>00678 <span class="comment">       *     n                       d</span>
<a name="l00679"></a>00679 <span class="comment">       *     - =   FrameTime   and   - = fps</span>
<a name="l00680"></a>00680 <span class="comment">       *     d                       n</span>
<a name="l00681"></a>00681 <span class="comment">       *</span>
<a name="l00682"></a>00682 <span class="comment">       *     d = (n * fps)</span>
<a name="l00683"></a>00683 <span class="comment">       */</span>
<a name="l00684"></a>00684       pCapture-&gt;<a class="code" href="struct__sCapture.html#16fd76e08c47f58270af077f852cbf06">StrmParm</a>.parm.capture.timeperframe.numerator = <a class="code" href="Capture_8c.html#16629b0e702fb84eb2acc4fc6b8b4876">NUMERATOR</a>;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686       <span class="comment">/* Multiply by 10 to increase precision, then add half lowest value and</span>
<a name="l00687"></a>00687 <span class="comment">       * divide by 10 to obtain the 'real' denominator.</span>
<a name="l00688"></a>00688 <span class="comment">       */</span>
<a name="l00689"></a>00689       pCapture-&gt;<a class="code" href="struct__sCapture.html#16fd76e08c47f58270af077f852cbf06">StrmParm</a>.parm.capture.timeperframe.denominator = ((<a class="code" href="Capture_8c.html#16629b0e702fb84eb2acc4fc6b8b4876">NUMERATOR</a> * <a class="code" href="Capture_8c.html#38e4d2eda9cecbb569bf455f7f52be76">DIVISOR</a> * pCapture-&gt;<a class="code" href="struct__sCapture.html#e401f9095d991b5518f74d204fee15a8">fFrameRate</a>) + (<a class="code" href="Capture_8c.html#38e4d2eda9cecbb569bf455f7f52be76">DIVISOR</a> / 2)) / <a class="code" href="Capture_8c.html#38e4d2eda9cecbb569bf455f7f52be76">DIVISOR</a>;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691       pCapture-&gt;<a class="code" href="struct__sCapture.html#16fd76e08c47f58270af077f852cbf06">StrmParm</a>.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00692"></a>00692       <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_S_PARM, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#16fd76e08c47f58270af077f852cbf06">StrmParm</a>)) &lt; 0)
<a name="l00693"></a>00693       {
<a name="l00694"></a>00694          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to set capture rate to %.2f: %d\n"</span>,
<a name="l00695"></a>00695                pCapture-&gt;<a class="code" href="struct__sCapture.html#e401f9095d991b5518f74d204fee15a8">fFrameRate</a>, rc);
<a name="l00696"></a>00696          <span class="keywordflow">return</span> rc;
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698    }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <span class="comment">/* Composing targets - layout of the image inside the output buffer */</span>
<a name="l00701"></a>00701    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#fe9c08a3712cc99dd0155b53be25f34a">ComposingActive</a>)
<a name="l00702"></a>00702    {
<a name="l00703"></a>00703       memset(&amp;compose, 0, <span class="keyword">sizeof</span>(compose));
<a name="l00704"></a>00704       compose.type     = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00705"></a>00705       compose.target   = V4L2_SEL_TGT_COMPOSE;
<a name="l00706"></a>00706       compose.r.left   = pCapture-&gt;<a class="code" href="struct__sCapture.html#c7295fe2ede7cd6671a6bc933529488b">ComposeLeft</a>;
<a name="l00707"></a>00707       compose.r.top    = pCapture-&gt;<a class="code" href="struct__sCapture.html#0d8687e02ed63140f1b5a00d607df087">ComposeTop</a>;
<a name="l00708"></a>00708       compose.r.width  = pCapture-&gt;<a class="code" href="struct__sCapture.html#deab540033b0cd9acbbd5e8e205a4088">ComposeWidth</a>;
<a name="l00709"></a>00709       compose.r.height = pCapture-&gt;<a class="code" href="struct__sCapture.html#4289cea196510d9782cc0840b2397fb8">ComposeHeight</a>;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Set composing rectangle(%d,%d,%d,%d)\n"</span>,
<a name="l00712"></a>00712             compose.r.left, compose.r.top, compose.r.width, compose.r.height);
<a name="l00713"></a>00713       <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_S_SELECTION, &amp;compose)) != 0)
<a name="l00714"></a>00714       {
<a name="l00715"></a>00715          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to set composing rectangle(%d,%d,%d,%d): %d\n"</span>,
<a name="l00716"></a>00716                compose.r.left, compose.r.top, compose.r.width, compose.r.height, rc);
<a name="l00717"></a>00717          <span class="keywordflow">return</span> rc;
<a name="l00718"></a>00718       }
<a name="l00719"></a>00719    }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721    memset(&amp;compose, 0, <span class="keyword">sizeof</span>(compose));
<a name="l00722"></a>00722    compose.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00723"></a>00723    compose.target = V4L2_SEL_TGT_COMPOSE;
<a name="l00724"></a>00724    <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_SELECTION, &amp;compose)) != 0)
<a name="l00725"></a>00725    {
<a name="l00726"></a>00726       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get composing: %d\n"</span>, rc);
<a name="l00727"></a>00727       <span class="keywordflow">return</span> rc;
<a name="l00728"></a>00728    }
<a name="l00729"></a>00729    <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Current composing rectangle is (%d,%d,%d,%d)\n"</span>,
<a name="l00730"></a>00730          compose.r.left, compose.r.top, compose.r.width, compose.r.height);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732    <span class="comment">/* Cropping targets */</span>
<a name="l00733"></a>00733    <span class="comment">/* Cropping bounds - all valid crop rectangles fit inside the crop bounds rectangle */</span>
<a name="l00734"></a>00734    memset(&amp;crop, 0, <span class="keyword">sizeof</span>(crop));
<a name="l00735"></a>00735    crop.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00736"></a>00736    crop.target = V4L2_SEL_TGT_CROP_BOUNDS;
<a name="l00737"></a>00737    <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_SELECTION, &amp;crop)) != 0)
<a name="l00738"></a>00738    {
<a name="l00739"></a>00739       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get cropping bounds: %d\n"</span>, rc);
<a name="l00740"></a>00740       <span class="keywordflow">return</span> rc;
<a name="l00741"></a>00741    }
<a name="l00742"></a>00742    <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Bounds of the crop rectangle are (%d,%d,%d,%d)\n"</span>,
<a name="l00743"></a>00743          crop.r.left, crop.r.top, crop.r.width, crop.r.height);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745    <span class="comment">/* Default cropping rectangle - covers the entire picture */</span>
<a name="l00746"></a>00746    memset(&amp;crop, 0, <span class="keyword">sizeof</span>(crop));
<a name="l00747"></a>00747    crop.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00748"></a>00748    crop.target = V4L2_SEL_TGT_CROP_DEFAULT;
<a name="l00749"></a>00749    <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_SELECTION, &amp;crop)) != 0)
<a name="l00750"></a>00750    {
<a name="l00751"></a>00751       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get default cropping: %d\n"</span>, rc);
<a name="l00752"></a>00752       <span class="keywordflow">return</span> rc;
<a name="l00753"></a>00753    }
<a name="l00754"></a>00754    <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Default crop rectangle is (%d,%d,%d,%d)\n"</span>,
<a name="l00755"></a>00755          crop.r.left, crop.r.top, crop.r.width, crop.r.height);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="comment">/* Active cropping rectangle */</span>
<a name="l00758"></a>00758    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#4758d737618eb39d7554a750310720c8">CroppingActive</a>)
<a name="l00759"></a>00759    {
<a name="l00760"></a>00760       memset(&amp;crop, 0, <span class="keyword">sizeof</span>(crop));
<a name="l00761"></a>00761       crop.type     = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00762"></a>00762       crop.target   = V4L2_SEL_TGT_CROP;
<a name="l00763"></a>00763       crop.r.left   = pCapture-&gt;<a class="code" href="struct__sCapture.html#3c68852e74cb68686fcdb79982143213">CroppingLeft</a>;
<a name="l00764"></a>00764       crop.r.top    = pCapture-&gt;<a class="code" href="struct__sCapture.html#8e594b2fcb85714434d98a86dc893836">CroppingTop</a>;
<a name="l00765"></a>00765       crop.r.width  = pCapture-&gt;<a class="code" href="struct__sCapture.html#95665907219daec88477d7f2bd57bdae">CroppingWidth</a>;
<a name="l00766"></a>00766       crop.r.height = pCapture-&gt;<a class="code" href="struct__sCapture.html#ade2e348785c5a106a30e3d3320268ad">CroppingHeight</a>;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Set cropping(%d,%d,%d,%d)\n"</span>,
<a name="l00769"></a>00769             crop.r.left, crop.r.top, crop.r.width, crop.r.height);
<a name="l00770"></a>00770       <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_S_SELECTION, &amp;crop)) != 0)
<a name="l00771"></a>00771       {
<a name="l00772"></a>00772          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to set cropping(%d,%d,%d,%d): %d\n"</span>,
<a name="l00773"></a>00773                crop.r.left, crop.r.top, crop.r.width, crop.r.height, rc);
<a name="l00774"></a>00774          <span class="keywordflow">return</span> rc;
<a name="l00775"></a>00775       }
<a name="l00776"></a>00776    }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778    memset(&amp;crop, 0, <span class="keyword">sizeof</span>(crop));
<a name="l00779"></a>00779    crop.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00780"></a>00780    crop.target = V4L2_SEL_TGT_CROP;
<a name="l00781"></a>00781    <span class="keywordflow">if</span>((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_SELECTION, &amp;crop)) != 0)
<a name="l00782"></a>00782    {
<a name="l00783"></a>00783       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get cropping: %d\n"</span>, rc);
<a name="l00784"></a>00784       <span class="keywordflow">return</span> rc;
<a name="l00785"></a>00785    }
<a name="l00786"></a>00786    <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Current crop rectangle is (%d,%d,%d,%d)\n"</span>,
<a name="l00787"></a>00787          crop.r.left, crop.r.top, crop.r.width, crop.r.height);
<a name="l00788"></a>00788 
<a name="l00789"></a>00789    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#a34a9494cf2b35ceed1a339700b9fc32">livestream</a>)
<a name="l00790"></a>00790    {
<a name="l00791"></a>00791       <span class="keyword">struct </span>v4l2_queryctrl queryctrl;
<a name="l00792"></a>00792       <span class="keyword">struct </span>v4l2_control control;
<a name="l00793"></a>00793 
<a name="l00794"></a>00794       memset(&amp;queryctrl, 0, <span class="keyword">sizeof</span>(queryctrl));
<a name="l00795"></a>00795       queryctrl.id = RGB133_V4L2_CID_LIVESTREAM;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797       <span class="keywordflow">if</span> ((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_QUERYCTRL, &amp;queryctrl)) == -1)
<a name="l00798"></a>00798       {
<a name="l00799"></a>00799          <span class="keywordflow">if</span> (errno != EINVAL)
<a name="l00800"></a>00800          {
<a name="l00801"></a>00801             <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"VIDIOC_QUERYCTRL failed for RGB133_V4L2_CID_LIVESTREAM, error(0x%x)\n"</span>, rc);
<a name="l00802"></a>00802             <span class="keywordflow">return</span> rc;
<a name="l00803"></a>00803          }
<a name="l00804"></a>00804          <span class="keywordflow">else</span>
<a name="l00805"></a>00805          {
<a name="l00806"></a>00806             <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"RGB133_V4L2_CID_LIVESTREAM is not supported\n"</span>);
<a name="l00807"></a>00807          }
<a name="l00808"></a>00808       }
<a name="l00809"></a>00809       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (queryctrl.flags &amp; V4L2_CTRL_FLAG_DISABLED)
<a name="l00810"></a>00810       {
<a name="l00811"></a>00811          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"RGB133_V4L2_CID_LIVESTREAM is not supported\n"</span>);
<a name="l00812"></a>00812       }
<a name="l00813"></a>00813       <span class="keywordflow">else</span>
<a name="l00814"></a>00814       {
<a name="l00815"></a>00815          memset(&amp;control, 0, <span class="keyword">sizeof</span> (control));
<a name="l00816"></a>00816          control.id = RGB133_V4L2_CID_LIVESTREAM;
<a name="l00817"></a>00817          control.value = pCapture-&gt;<a class="code" href="struct__sCapture.html#a34a9494cf2b35ceed1a339700b9fc32">livestream</a>;
<a name="l00818"></a>00818 
<a name="l00819"></a>00819          <span class="keywordflow">if</span> ((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_S_CTRL, &amp;control)) == -1)
<a name="l00820"></a>00820          {
<a name="l00821"></a>00821             perror(<span class="stringliteral">"VIDIOC_S_CTRL failed for RGB133_V4L2_CID_LIVESTREAM: "</span>);
<a name="l00822"></a>00822             <span class="keywordflow">return</span> rc;
<a name="l00823"></a>00823          }
<a name="l00824"></a>00824       }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826       memset(&amp;control, 0, <span class="keyword">sizeof</span> (control));
<a name="l00827"></a>00827       control.id = RGB133_V4L2_CID_LIVESTREAM;
<a name="l00828"></a>00828 
<a name="l00829"></a>00829       <span class="keywordflow">if</span> ((rc = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_CTRL, &amp;control)) == -1)
<a name="l00830"></a>00830       {
<a name="l00831"></a>00831          perror(<span class="stringliteral">"VIDIOC_G_CTRL failed for RGB133_V4L2_CID_LIVESTREAM: "</span>);
<a name="l00832"></a>00832          <span class="keywordflow">return</span> rc;
<a name="l00833"></a>00833       }
<a name="l00834"></a>00834 
<a name="l00835"></a>00835       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"RGB133_V4L2_CID_LIVESTREAM current value: %d\n"</span>, control.value);
<a name="l00836"></a>00836    }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838    <span class="keywordflow">return</span> rc;
<a name="l00839"></a>00839 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d9c81ca1c4c7610a71773a7db7aff659"></a><!-- doxytag: member="Capture.h::InitialiseMmapCapture" ref="d9c81ca1c4c7610a71773a7db7aff659" args="(psCapture pCapture, unsigned int buffer_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitialiseMmapCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of InitialiseMmapCapture. <div class="fragment"><pre class="fragment"><a name="l00492"></a>00492 {
<a name="l00493"></a>00493    <span class="keywordtype">int</span> ret = 0;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495    memset( &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>, 0, <span class="keyword">sizeof</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>) );
<a name="l00496"></a>00496    pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.count = <a class="code" href="Capture_8h.html#fab7e80b660d9cc4150a9992888bd56d">NUM_STREAMING_BUFFERS</a>;
<a name="l00497"></a>00497    pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00498"></a>00498    pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.memory = V4L2_MEMORY_MMAP;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500    <span class="keywordflow">if</span>((ret = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_REQBUFS, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>)) &lt; 0)
<a name="l00501"></a>00501    {
<a name="l00502"></a>00502        <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Device does not support mmap IO: %d\n"</span>, ret);
<a name="l00503"></a>00503        <span class="keywordflow">return</span> -1;
<a name="l00504"></a>00504    }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506    <span class="keywordflow">if</span>( pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.count &lt; <a class="code" href="Capture_8h.html#fab7e80b660d9cc4150a9992888bd56d">NUM_STREAMING_BUFFERS</a> )
<a name="l00507"></a>00507    {
<a name="l00508"></a>00508       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Insufficient buffers (%d, expected %d) for mmap IO\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.count, <a class="code" href="Capture_8h.html#fab7e80b660d9cc4150a9992888bd56d">NUM_STREAMING_BUFFERS</a>);
<a name="l00509"></a>00509       <span class="keywordflow">return</span> -1;
<a name="l00510"></a>00510    }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512    <span class="keywordflow">if</span>(buffer_size == 0)
<a name="l00513"></a>00513    {
<a name="l00514"></a>00514       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Invalid buffer initialisation size: %u bytes\n"</span>, buffer_size);
<a name="l00515"></a>00515       <span class="keywordflow">return</span> -1;
<a name="l00516"></a>00516    }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <span class="keywordflow">for</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a> = 0; pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a> &lt; pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.count; ++pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a> )
<a name="l00519"></a>00519    {
<a name="l00520"></a>00520       <span class="keyword">struct </span>v4l2_buffer buf;
<a name="l00521"></a>00521       memset(&amp;buf, 0, <span class="keyword">sizeof</span>(buf));
<a name="l00522"></a>00522       buf.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00523"></a>00523       buf.memory = V4L2_MEMORY_MMAP;
<a name="l00524"></a>00524       buf.index = pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526       <span class="keywordflow">if</span>((ret = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_QUERYBUF, &amp;buf)) &lt; 0)
<a name="l00527"></a>00527       {
<a name="l00528"></a>00528          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"VIDIOC_QUERYBUF failed: %d\n"</span>, ret);
<a name="l00529"></a>00529          <span class="keywordflow">return</span> -1;
<a name="l00530"></a>00530       }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532       pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = buf.length;
<a name="l00533"></a>00533       pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> =
<a name="l00534"></a>00534             mmap( NULL, buf.length, PROT_READ | PROT_WRITE, MAP_SHARED, pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, buf.m.offset );
<a name="l00535"></a>00535 
<a name="l00536"></a>00536       <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Mmap buffer[%d](%p) of %u bytes mmap'd.\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>,
<a name="l00537"></a>00537             pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].pData,
<a name="l00538"></a>00538             pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].DataLength);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540       <span class="keywordflow">if</span>( pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].pData == MAP_FAILED )
<a name="l00541"></a>00541       {
<a name="l00542"></a>00542          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to mmap buffer[%d]\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>);
<a name="l00543"></a>00543          <span class="keywordflow">return</span> -1;
<a name="l00544"></a>00544       }
<a name="l00545"></a>00545    }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547    <span class="keywordflow">return</span> 0;
<a name="l00548"></a>00548 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="95ccbfb78416121353034ce553f3941f"></a><!-- doxytag: member="Capture.h::InitialiseReadCapture" ref="95ccbfb78416121353034ce553f3941f" args="(psCapture pCapture, unsigned int buffer_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitialiseReadCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of InitialiseReadCapture. <div class="fragment"><pre class="fragment"><a name="l00457"></a>00457 {
<a name="l00458"></a>00458    <span class="keywordflow">if</span>(buffer_size == 0)
<a name="l00459"></a>00459    {
<a name="l00460"></a>00460       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Invalid buffer initialisation size: %u bytes\n"</span>, buffer_size);
<a name="l00461"></a>00461       <span class="keywordflow">return</span> -1;
<a name="l00462"></a>00462    }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464    pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = buffer_size;
<a name="l00465"></a>00465    pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> = malloc(buffer_size);
<a name="l00466"></a>00466    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> == 0)
<a name="l00467"></a>00467       <span class="keywordflow">return</span> -1;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469    <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Read buffer(%p) of %u bytes initialised.\n"</span>,
<a name="l00470"></a>00470          pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>, pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a>);
<a name="l00471"></a>00471    <span class="keywordflow">return</span> 0;
<a name="l00472"></a>00472 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6f89dd6def14eee7d40c0824b094f0a7"></a><!-- doxytag: member="Capture.h::InitialiseUserPtrCapture" ref="6f89dd6def14eee7d40c0824b094f0a7" args="(psCapture pCapture, unsigned int buffer_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitialiseUserPtrCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of InitialiseUserPtrCapture. <div class="fragment"><pre class="fragment"><a name="l00554"></a>00554 {
<a name="l00555"></a>00555    <span class="keywordtype">int</span> ret = 0;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    memset( &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>, 0, <span class="keyword">sizeof</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>) );
<a name="l00558"></a>00558    pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.count = <a class="code" href="Capture_8h.html#fab7e80b660d9cc4150a9992888bd56d">NUM_STREAMING_BUFFERS</a>;
<a name="l00559"></a>00559    pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00560"></a>00560    pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.memory = V4L2_MEMORY_USERPTR;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562    <span class="keywordflow">if</span>(buffer_size == 0)
<a name="l00563"></a>00563    {
<a name="l00564"></a>00564       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Invalid buffer initialisation size: %u bytes\n"</span>, buffer_size);
<a name="l00565"></a>00565       <span class="keywordflow">return</span> -1;
<a name="l00566"></a>00566    }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568    <span class="keywordflow">if</span>((ret = ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_REQBUFS, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>)) &lt; 0)
<a name="l00569"></a>00569    {
<a name="l00570"></a>00570        <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Device does not support userptr IO: %d\n"</span>, ret);
<a name="l00571"></a>00571        <span class="keywordflow">return</span> -1;
<a name="l00572"></a>00572    }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574    <span class="keywordflow">for</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a> = 0; pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a> &lt; pCapture-&gt;<a class="code" href="struct__sCapture.html#4ed1e1db95ef61e3cbfee68c06e16e14">req</a>.count; ++pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>)
<a name="l00575"></a>00575    {
<a name="l00576"></a>00576       pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> = malloc(buffer_size);
<a name="l00577"></a>00577       <span class="keywordflow">if</span>(!pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].pData)
<a name="l00578"></a>00578       {
<a name="l00579"></a>00579          <span class="keywordtype">int</span> i;
<a name="l00580"></a>00580          <span class="comment">// If allocation fails, free buffers we managed to allocate, then return</span>
<a name="l00581"></a>00581          <span class="keywordflow">for</span>(i = (pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a> - 1); i &gt;= 0; --i)
<a name="l00582"></a>00582          {
<a name="l00583"></a>00583             free(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>);
<a name="l00584"></a>00584             pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> = 0;
<a name="l00585"></a>00585             pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = 0;
<a name="l00586"></a>00586          }
<a name="l00587"></a>00587          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to allocate buffer %d for userptr io\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>);
<a name="l00588"></a>00588          <span class="keywordflow">return</span> -1;
<a name="l00589"></a>00589       }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591       pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = buffer_size;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593       <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Userptr buffer[%d](%p) of %u bytes allocated.\n"</span>,
<a name="l00594"></a>00594             pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>,
<a name="l00595"></a>00595             pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].pData,
<a name="l00596"></a>00596             pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>].DataLength);
<a name="l00597"></a>00597    }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599    <span class="keywordflow">return</span> 0;
<a name="l00600"></a>00600 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5fb866fca5bb4eddd5a740b491e0bca1"></a><!-- doxytag: member="Capture.h::IsSupportedPixelFormat" ref="5fb866fca5bb4eddd5a740b491e0bca1" args="(char *pixfmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int IsSupportedPixelFormat           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>pixfmt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of IsSupportedPixelFormat. <div class="fragment"><pre class="fragment"><a name="l00064"></a>00064 {
<a name="l00065"></a>00065    <span class="keywordtype">int</span> len = -1;
<a name="l00066"></a>00066    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pixelformat = 0;
<a name="l00067"></a>00067    <span class="keywordtype">int</span> supported = 0;
<a name="l00068"></a>00068    <span class="keywordtype">int</span> i = 0;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070    <span class="keywordflow">if</span>(pixfmt == 0)
<a name="l00071"></a>00071       <span class="keywordflow">return</span> 0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073    len = strlen(pixfmt);
<a name="l00074"></a>00074    <span class="keywordflow">if</span>(len &lt;= 0 ||
<a name="l00075"></a>00075       len &gt; 4)
<a name="l00076"></a>00076    {
<a name="l00077"></a>00077       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Invalid fourcc pixel format: %s\n"</span>, pixfmt);
<a name="l00078"></a>00078       <span class="keywordflow">return</span> 0;
<a name="l00079"></a>00079    }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081    <span class="comment">/* Pad with spaces if necessary */</span>
<a name="l00082"></a>00082    <span class="keywordflow">if</span>(len &lt; 4)
<a name="l00083"></a>00083       <span class="keywordflow">for</span>(i=4; i!=len; i--)
<a name="l00084"></a>00084          pixfmt[i-1] = <span class="charliteral">' '</span>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086    pixelformat = v4l2_fourcc(pixfmt[0], pixfmt[1], pixfmt[2], pixfmt[3]);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    i = 0;
<a name="l00089"></a>00089    <span class="keywordflow">while</span>(<a class="code" href="Capture_8c.html#cf4765e987ecd2ca3d91c57962743e91">v4l2chroma_to_fourcc</a>[i].<a class="code" href="Capture_8c.html#05bca6f7f372112af20638ebaacc3179">i_v4l2</a>)
<a name="l00090"></a>00090    {
<a name="l00091"></a>00091       <span class="keywordflow">if</span>(pixelformat == <a class="code" href="Capture_8c.html#cf4765e987ecd2ca3d91c57962743e91">v4l2chroma_to_fourcc</a>[i].<a class="code" href="Capture_8c.html#ac102bcf444a0617d02c98ce61a817d8">i_fourcc</a>)
<a name="l00092"></a>00092       {
<a name="l00093"></a>00093          supported++;
<a name="l00094"></a>00094          <span class="keywordflow">break</span>;
<a name="l00095"></a>00095       }
<a name="l00096"></a>00096       i++;
<a name="l00097"></a>00097    }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099    <span class="keywordflow">if</span>(supported)
<a name="l00100"></a>00100       <span class="keywordflow">return</span> <a class="code" href="Capture_8c.html#cf4765e987ecd2ca3d91c57962743e91">v4l2chroma_to_fourcc</a>[i].i_v4l2;
<a name="l00101"></a>00101    <span class="keywordflow">else</span>
<a name="l00102"></a>00102       <span class="keywordflow">return</span> 0;
<a name="l00103"></a>00103 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e187b90c9ab74448d17af5cbbd5afff3"></a><!-- doxytag: member="Capture.h::OpenCaptureDevice" ref="e187b90c9ab74448d17af5cbbd5afff3" args="(char *device, psCapture pCapture, BOOL bBlock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OpenCaptureDevice           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="Capture_8h.html#3eeb09936e8b8b09aaad26ff2c859eb7">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>blocking</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of OpenCaptureDevice. <div class="fragment"><pre class="fragment"><a name="l00256"></a>00256 {
<a name="l00257"></a>00257    <span class="keywordtype">char</span>* realDevice = 0;
<a name="l00258"></a>00258    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags = O_RDWR;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="keywordflow">if</span>(device[0])
<a name="l00261"></a>00261    {
<a name="l00262"></a>00262       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Opening capture device: %s\n"</span>, device);
<a name="l00263"></a>00263       realDevice = device;
<a name="l00264"></a>00264    }
<a name="l00265"></a>00265    <span class="keywordflow">else</span>
<a name="l00266"></a>00266    {
<a name="l00267"></a>00267       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Opening default capture device: %s\n"</span>, <a class="code" href="Capture_8c.html#19f25d264a1ef02bc7113b259f003bbf">defaultDevice</a>);
<a name="l00268"></a>00268       realDevice = (<span class="keywordtype">char</span>*)<a class="code" href="Capture_8c.html#19f25d264a1ef02bc7113b259f003bbf">defaultDevice</a>;
<a name="l00269"></a>00269    }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271    <span class="keywordflow">if</span>(blocking)
<a name="l00272"></a>00272    {
<a name="l00273"></a>00273       flags |= O_NONBLOCK;
<a name="l00274"></a>00274       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Opening device with non-blocking IO (0x%lx)\n"</span>, flags);
<a name="l00275"></a>00275    }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277    <span class="comment">/* Open the device */</span>
<a name="l00278"></a>00278    <span class="keywordflow">if</span>((pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a> = open(realDevice, flags)) &lt; 0)
<a name="l00279"></a>00279    {
<a name="l00280"></a>00280       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to open \"%s\"\n"</span>, realDevice);
<a name="l00281"></a>00281       <span class="keywordflow">goto</span> open_failed;
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="comment">/* Query the capture device capabilites */</span>
<a name="l00285"></a>00285    <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Query device capabilities into %p\n"</span>, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#9f980c189ebf1460e711142957bcf1c0">caps</a>);
<a name="l00286"></a>00286    <span class="keywordflow">if</span>(ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_QUERYCAP, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#9f980c189ebf1460e711142957bcf1c0">caps</a>) &lt; 0)
<a name="l00287"></a>00287    {
<a name="l00288"></a>00288       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to query device capabilities.\n"</span>);
<a name="l00289"></a>00289       <span class="keywordflow">goto</span> open_failed;
<a name="l00290"></a>00290    }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    <span class="comment">/* Enumerate Capture Device Capabilities */</span>
<a name="l00293"></a>00293    <span class="keywordflow">if</span>( pCapture-&gt;<a class="code" href="struct__sCapture.html#9f980c189ebf1460e711142957bcf1c0">caps</a>.capabilities &amp; V4L2_CAP_VIDEO_CAPTURE )
<a name="l00294"></a>00294    {
<a name="l00295"></a>00295       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Enumerate Capture Inputs\n"</span>);
<a name="l00296"></a>00296       <span class="keywordflow">if</span>(<a class="code" href="Capture_8c.html#05ed8ae25cc33b860a744c21d49ae51e">EnumerateCaptureInputs</a>(pCapture))
<a name="l00297"></a>00297       {
<a name="l00298"></a>00298          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to enumerate capture inputs: %d\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#f41c0a3893467798a400eed15bcbe6d9">inputs</a>);
<a name="l00299"></a>00299          <span class="keywordflow">goto</span> open_failed;
<a name="l00300"></a>00300       }
<a name="l00301"></a>00301       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Enumerate Video Standards\n"</span>);
<a name="l00302"></a>00302       <span class="keywordflow">if</span>(<a class="code" href="Capture_8c.html#5d2c81df72ddcc142a58c1b4d6fa3be8">EnumerateVideoStandards</a>(pCapture))
<a name="l00303"></a>00303       {
<a name="l00304"></a>00304          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to enumerate video standards: %d\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#6c4955c3143ec8a52272b694a5772e6c">standards</a>);
<a name="l00305"></a>00305          <span class="keywordflow">goto</span> open_failed;
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Enumerate Capture Formats\n"</span>);
<a name="l00308"></a>00308       <span class="keywordflow">if</span>(<a class="code" href="Capture_8c.html#f8bc2ed998fb073ae0a8b1e3cc30e2e1">EnumerateCaptureFormats</a>(pCapture))
<a name="l00309"></a>00309       {
<a name="l00310"></a>00310          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to enumerate capture formats: %d\n"</span>, pCapture-&gt;<a class="code" href="struct__sCapture.html#d42b824a14cd841f01ac25f1114d6de9">formats</a>);
<a name="l00311"></a>00311          <span class="keywordflow">goto</span> open_failed;
<a name="l00312"></a>00312       }
<a name="l00313"></a>00313    }
<a name="l00314"></a>00314    <span class="keywordflow">else</span>
<a name="l00315"></a>00315    {
<a name="l00316"></a>00316       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Only Video Captures are supported by this application.\n"</span>);
<a name="l00317"></a>00317       <span class="keywordflow">goto</span> open_failed;
<a name="l00318"></a>00318    }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320    <span class="comment">/* Check the io method */</span>
<a name="l00321"></a>00321    <span class="keywordflow">if</span>( !(pCapture-&gt;<a class="code" href="struct__sCapture.html#9f980c189ebf1460e711142957bcf1c0">caps</a>.capabilities &amp; V4L2_CAP_READWRITE) )
<a name="l00322"></a>00322    {
<a name="l00323"></a>00323       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Capture device does not supoprt read io\n"</span>);
<a name="l00324"></a>00324       <span class="keywordflow">goto</span> open_failed;
<a name="l00325"></a>00325    }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    <span class="comment">/* Try and find default resolution if not specified */</span>
<a name="l00328"></a>00328    memset( &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>, 0, <span class="keyword">sizeof</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>) );
<a name="l00329"></a>00329    pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331    <span class="keywordflow">if</span>( pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a> == 0 || pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a> == 0 )
<a name="l00332"></a>00332    {
<a name="l00333"></a>00333       <span class="comment">/* Use current width and height settings */</span>
<a name="l00334"></a>00334       <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Get Current source width and height.\n"</span>);
<a name="l00335"></a>00335       <span class="keywordflow">if</span>(ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_FMT, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>) &lt; 0)
<a name="l00336"></a>00336       {
<a name="l00337"></a>00337          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get current source width and height\n"</span>);
<a name="l00338"></a>00338          <span class="keywordflow">goto</span> open_failed;
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341       pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a>  = pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.width;
<a name="l00342"></a>00342       pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a> = pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.height;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344       <span class="keywordflow">if</span>( pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.field == V4L2_FIELD_ALTERNATE )
<a name="l00345"></a>00345       {
<a name="l00346"></a>00346          pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a> = pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a> * 2;
<a name="l00347"></a>00347       }
<a name="l00348"></a>00348    }
<a name="l00349"></a>00349    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a> &lt; 0 || pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a> &lt; 0 )
<a name="l00350"></a>00350    {
<a name="l00351"></a>00351       <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Using Optimal width and height.\n"</span>);
<a name="l00352"></a>00352    }
<a name="l00353"></a>00353    <span class="keywordflow">else</span>
<a name="l00354"></a>00354    {
<a name="l00355"></a>00355        <span class="comment">/* The width and height have come from the command line (or defaults) */</span>
<a name="l00356"></a>00356       <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Using Specified width and height -&gt; %lux%lu\n"</span>,
<a name="l00357"></a>00357             pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a>, pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a>);
<a name="l00358"></a>00358    }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360    pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.width = pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a>;
<a name="l00361"></a>00361    pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.height = pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a>;
<a name="l00362"></a>00362    pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.field = V4L2_FIELD_NONE;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364    <span class="comment">/* Setup Capture Format */</span>
<a name="l00365"></a>00365    pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.pixelformat = pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>;
<a name="l00366"></a>00366    <span class="keywordflow">if</span>(ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_S_FMT, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>) &lt; 0)
<a name="l00367"></a>00367    {
<a name="l00368"></a>00368       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to set capture format: %lux%lu for 0x%x (%c%c%c%c)\n"</span>,
<a name="l00369"></a>00369             pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a>, pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a>,
<a name="l00370"></a>00370             pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>,
<a name="l00371"></a>00371             ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[0],
<a name="l00372"></a>00372             ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[1],
<a name="l00373"></a>00373             ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[2],
<a name="l00374"></a>00374             ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[3]);
<a name="l00375"></a>00375       <span class="keywordflow">goto</span> open_failed;
<a name="l00376"></a>00376    }
<a name="l00377"></a>00377    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Set capture format: %lux%lu for 0x%x (%c%c%c%c)\n"</span>,
<a name="l00378"></a>00378          pCapture-&gt;<a class="code" href="struct__sCapture.html#a06f3280921a3feb27893c94969db90e">output_width</a>, pCapture-&gt;<a class="code" href="struct__sCapture.html#a39ba17cbed01b022891692bc52ce3a2">output_height</a>,
<a name="l00379"></a>00379          pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>,
<a name="l00380"></a>00380          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[0],
<a name="l00381"></a>00381          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[1],
<a name="l00382"></a>00382          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[2],
<a name="l00383"></a>00383          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#89cfa53ef72332e4cbd5262f049e9247">output_pixfmt</a>)[3]);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385    <span class="comment">/* Read back set width and height settings */</span>
<a name="l00386"></a>00386    <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"read back set output buffer width and height.\n"</span>);
<a name="l00387"></a>00387    <span class="keywordflow">if</span>(ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_FMT, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>) &lt; 0)
<a name="l00388"></a>00388    {
<a name="l00389"></a>00389       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get current output buffer width and height\n"</span>);
<a name="l00390"></a>00390       <span class="keywordflow">goto</span> open_failed;
<a name="l00391"></a>00391    }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393    <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Capture format: %ux%u for 0x%x (%c%c%c%c)\n"</span>,
<a name="l00394"></a>00394          pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.width, pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.height,
<a name="l00395"></a>00395          pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.pixelformat,
<a name="l00396"></a>00396          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.pixelformat)[0],
<a name="l00397"></a>00397          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.pixelformat)[1],
<a name="l00398"></a>00398          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.pixelformat)[2],
<a name="l00399"></a>00399          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#8ff277e58f22a1b6739fe85fe1596069">fmt</a>.fmt.pix.pixelformat)[3]);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    <span class="comment">/* Get the source width and height settings */</span>
<a name="l00402"></a>00402    memset( &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>, 0, <span class="keyword">sizeof</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>) );
<a name="l00403"></a>00403    pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.type = V4L2_BUF_TYPE_CAPTURE_SOURCE;
<a name="l00404"></a>00404    <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"read source width and height.\n"</span>);
<a name="l00405"></a>00405    <span class="keywordflow">if</span>((ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, RGB133_VIDIOC_G_SRC_FMT, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>)) &lt; 0)
<a name="l00406"></a>00406    {
<a name="l00407"></a>00407       <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get source input format through proprietary ioctl\n"</span>);
<a name="l00408"></a>00408       <span class="keywordflow">if</span>(ioctl(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, VIDIOC_G_FMT, &amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>) &lt; 0)
<a name="l00409"></a>00409       {
<a name="l00410"></a>00410          <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to get source input format using ioctl\n"</span>);
<a name="l00411"></a>00411          <span class="keywordflow">goto</span> open_failed;
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413       <span class="keywordflow">else</span>
<a name="l00414"></a>00414       {
<a name="l00415"></a>00415          <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Source format (ioctl): "</span>);
<a name="l00416"></a>00416       }
<a name="l00417"></a>00417    }
<a name="l00418"></a>00418    <span class="keywordflow">else</span>
<a name="l00419"></a>00419    {
<a name="l00420"></a>00420       <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"Source format (proprietary ioctl): "</span>);
<a name="l00421"></a>00421    }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423    <a class="code" href="CaptureDebug_8h.html#3d75a908969b7e8c6c4e75753da3f0ed">CapLog</a>(<span class="stringliteral">"%ux%u @ %.2fHz for 0x%x (%c%c%c%c)\n"</span>,
<a name="l00424"></a>00424          pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.width, pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.height,
<a name="l00425"></a>00425          (<span class="keywordtype">float</span>)((<span class="keywordtype">float</span>)pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.priv / 1000.0),
<a name="l00426"></a>00426          pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.pixelformat,
<a name="l00427"></a>00427          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.pixelformat)[0],
<a name="l00428"></a>00428          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.pixelformat)[1],
<a name="l00429"></a>00429          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.pixelformat)[2],
<a name="l00430"></a>00430          ((<span class="keywordtype">char</span>*)&amp;pCapture-&gt;<a class="code" href="struct__sCapture.html#39ced2e929f56840c04e7b11a5ecf988">src_fmt</a>.fmt.pix.pixelformat)[3]);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432    <span class="keywordflow">return</span> 0;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 open_failed:
<a name="l00435"></a>00435    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a> &gt;= 0)
<a name="l00436"></a>00436       <a class="code" href="Capture_8h.html#70999d21cf9cba87e7513ad225e92f41">CloseCaptureDevice</a>(pCapture-&gt;<a class="code" href="struct__sCapture.html#0fc7bc3b9328ed32a2e2355c8f7595d4">fd</a>, pCapture);
<a name="l00437"></a>00437    <span class="keywordflow">return</span> -1;
<a name="l00438"></a>00438 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="269745cd0d528279e695e6245675679e"></a><!-- doxytag: member="Capture.h::OpenCaptureDeviceControl" ref="269745cd0d528279e695e6245675679e" args="(psCapture pCapture, const char *ctrlDevice)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OpenCaptureDeviceControl           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ctrlDevice</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of OpenCaptureDeviceControl. <div class="fragment"><pre class="fragment"><a name="l00444"></a>00444 {
<a name="l00445"></a>00445    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Opening capture device control: %s\n"</span>, ctrlDevice);
<a name="l00446"></a>00446    <span class="comment">/* Open the device */</span>
<a name="l00447"></a>00447    <span class="keywordflow">if</span>((pCapture-&gt;<a class="code" href="struct__sCapture.html#0cd5400e54ba030d47f97ebee7ae7fb6">ctrlFd</a> = open(ctrlDevice, O_RDWR)) &lt; 0)
<a name="l00448"></a>00448       <span class="keywordflow">return</span> -1;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    <span class="keywordflow">return</span> 0;
<a name="l00451"></a>00451 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cae4622ab88f429fbaf6fb4810ff2dd1"></a><!-- doxytag: member="Capture.h::StartCapture" ref="cae4622ab88f429fbaf6fb4810ff2dd1" args="(psCapture pCapture)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int StartCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of InitialiseCapture. <div class="fragment"><pre class="fragment"><a name="l00845"></a>00845 {
<a name="l00846"></a>00846    <a class="code" href="struct__sCaptureThreadArgs.html">psCaptureThreadArgs</a> pCaptureThreadArgs = 0;
<a name="l00847"></a>00847    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Start Capture Thread...\n"</span>);
<a name="l00848"></a>00848    <span class="keywordflow">if</span>(<a class="code" href="CaptureThread_8h.html#7f8e037f719ccff4e836eb6544fe0724">CreateCaptureThread</a>(pCapture, pCaptureThreadArgs))
<a name="l00849"></a>00849       <span class="keywordflow">return</span> -1;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Wait Capture Thread...\n"</span>);
<a name="l00852"></a>00852    <a class="code" href="CaptureThread_8h.html#510ce04deaf19c5cc3f80586323c93de">JoinCaptureThread</a>(pCapture);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854    <a class="code" href="CaptureDebug_8h.html#c4207172cee8d278a755de8a00495a09">CapDebug</a>(<span class="stringliteral">"Joined Capture Thread...\n"</span>);
<a name="l00855"></a>00855    <a class="code" href="CaptureThread_8h.html#ef53f4d0916dc3de34f497ec83677a36">FreeCaptureThreadArgs</a>(&amp;pCaptureThreadArgs);
<a name="l00856"></a>00856 
<a name="l00857"></a>00857    <span class="keywordflow">return</span> 0;
<a name="l00858"></a>00858 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="60475b15bcc2b6246d7b46d18dcddff0"></a><!-- doxytag: member="Capture.h::UninitialiseMmapCapture" ref="60475b15bcc2b6246d7b46d18dcddff0" args="(psCapture pCapture)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int UninitialiseMmapCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of InitialiseMmapCapture. <div class="fragment"><pre class="fragment"><a name="l00606"></a>00606 {
<a name="l00607"></a>00607    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l00608"></a>00608    <span class="keywordflow">for</span>(i=0; i&lt;pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>; i++)
<a name="l00609"></a>00609    {
<a name="l00610"></a>00610       <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> != 0)
<a name="l00611"></a>00611       {
<a name="l00612"></a>00612          <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Uninitialise mmap buffer[%d](%p) of %u bytes.\n"</span>, i,
<a name="l00613"></a>00613                pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>,
<a name="l00614"></a>00614                pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a>);
<a name="l00615"></a>00615          <span class="keywordflow">if</span>(munmap(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>, pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a>))
<a name="l00616"></a>00616          {
<a name="l00617"></a>00617             <a class="code" href="CaptureDebug_8h.html#8fe7c9e10b6ad1781433dc234d91e607">CapError</a>(<span class="stringliteral">"Failed to munmap buffer[%d]"</span>, i);
<a name="l00618"></a>00618          }
<a name="l00619"></a>00619          pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> = 0;
<a name="l00620"></a>00620          pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = 0;
<a name="l00621"></a>00621       }
<a name="l00622"></a>00622    }
<a name="l00623"></a>00623    <span class="keywordflow">return</span> 0;
<a name="l00624"></a>00624 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="874c690a8b26f9133303818f37009920"></a><!-- doxytag: member="Capture.h::UninitialiseReadCapture" ref="874c690a8b26f9133303818f37009920" args="(psCapture pCapture)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int UninitialiseReadCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of UninitialiseReadCapture. <div class="fragment"><pre class="fragment"><a name="l00478"></a>00478 {
<a name="l00479"></a>00479    <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> != 0)
<a name="l00480"></a>00480    {
<a name="l00481"></a>00481       free(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>);
<a name="l00482"></a>00482       pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> = 0;
<a name="l00483"></a>00483       pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[0].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = 0;
<a name="l00484"></a>00484    }
<a name="l00485"></a>00485    <span class="keywordflow">return</span> 0;
<a name="l00486"></a>00486 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8f2b074dc39118a4a32364182d590290"></a><!-- doxytag: member="Capture.h::UninitialiseUserptrCapture" ref="8f2b074dc39118a4a32364182d590290" args="(psCapture pCapture)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int UninitialiseUserptrCapture           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__sCapture.html">psCapture</a>&nbsp;</td>
          <td class="paramname"> <em>pCapture</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of UninitialiseUserptrCapture. <div class="fragment"><pre class="fragment"><a name="l00630"></a>00630 {
<a name="l00631"></a>00631    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l00632"></a>00632    <span class="keywordflow">for</span>(i=0; i&lt;pCapture-&gt;<a class="code" href="struct__sCapture.html#1fae6bfdcac204719720fef9347e2606">buffers</a>; i++)
<a name="l00633"></a>00633    {
<a name="l00634"></a>00634       <span class="keywordflow">if</span>(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> != 0)
<a name="l00635"></a>00635       {
<a name="l00636"></a>00636          <a class="code" href="CaptureDebug_8h.html#7a76d7f019e9b054b0ccb5ff6e24b398">CapMessage</a>(<span class="stringliteral">"Uninitialise userptr buffer[%d](%p) of %u bytes.\n"</span>, i,
<a name="l00637"></a>00637                pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>,
<a name="l00638"></a>00638                pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a>);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640          free(pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a>);
<a name="l00641"></a>00641          pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#b4bba204a53aa9716e77f064ad5ba904">pData</a> = 0;
<a name="l00642"></a>00642          pCapture-&gt;<a class="code" href="struct__sCapture.html#127660c15914718025ee7997a221f751">pBuffers</a>[i].<a class="code" href="struct__sBuffer.html#d28a234584287d68ea4e8e51c560b0eb">DataLength</a> = 0;
<a name="l00643"></a>00643       }
<a name="l00644"></a>00644    }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646    <span class="keywordflow">return</span> 0;
<a name="l00647"></a>00647 }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Thu Apr 13 14:13:23 2023 for Vision Utils by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
